--- source/common/common/win32/thread_impl.h
+++ source/common/common/win32/thread_impl.h
@@ -39,7 +39,7 @@
 public:
   // Thread::ThreadFactory
   ThreadPtr createThread(std::function<void()> thread_routine, OptionsOptConstRef options) override;
-  ThreadId currentThreadId() override;
+  ThreadId currentThreadId() const override;
 };
 
 } // namespace Thread
--- source/common/common/win32/thread_impl.cc
+++ source/common/common/win32/thread_impl.cc
@@ -22,9 +22,9 @@
         return 0;
       },
       this, 0, nullptr));
-  if (options && options.thread_priority_ &&
-      !SetThreadPriority(thread_handle_, *options.thread_priority_)) {
-    ENVOY_LOG_MISC(warn, "Could not set the thread priority to {}", *options.thread_priority_);
+  if (options && options->priority_ &&
+      !SetThreadPriority(thread_handle_, *options->priority_)) {
+    ENVOY_LOG_MISC(warn, "Could not set the thread priority to {}", *options->priority_);
   }
   RELEASE_ASSERT(thread_handle_ != 0, "");
 }
@@ -42,7 +42,7 @@
   return std::make_unique<ThreadImplWin32>(thread_routine, options);
 }
 
-ThreadId ThreadFactoryImplWin32::currentThreadId() {
+ThreadId ThreadFactoryImplWin32::currentThreadId() const {
   // TODO(mhoran): test this in windows please.
   return ThreadId(static_cast<int64_t>(::GetCurrentThreadId()));
 }
--- envoy/api/os_sys_calls.h
+++ envoy/api/os_sys_calls.h
@@ -1,17 +1,27 @@
 #pragma once
 
+#ifndef WIN32
 #include <sys/resource.h>
+#endif
 #include <sys/stat.h>
 
 #include <chrono>
 #include <memory>
 #include <string>
 #include <vector>
 
 #include "envoy/api/os_sys_calls_common.h"
 #include "envoy/common/platform.h"
 #include "envoy/common/pure.h"
 #include "envoy/network/address.h"
 
+#ifdef WIN32
+struct rlimit {
+  int rlim_cur;
+  int rlim_max;
+};
+#define RLIMIT_NOFILE 7
+#endif
+
 namespace Envoy {
 namespace Api {
--- source/extensions/common/aws/BUILD
+++ source/extensions/common/aws/BUILD
@@ -75,6 +75,7 @@
     ],
     deps = [
         "//envoy/common:pure_lib",
+        "//envoy/common:time_interface",
         "//source/common/common:cleanup_lib",
         "//source/common/common:lock_guard_lib",
         "//source/common/common:thread_lib",
--- WORKSPACE
+++ WORKSPACE
@@ -1,5 +1,23 @@
 workspace(name = "envoy")

+load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")
+
+http_archive(
+    name = "dlfcn-win32",
+    build_file_content = """
+cc_library(
+    name = "dlfcn-win32",
+    srcs = ["src/dlfcn.c"],
+    hdrs = ["src/dlfcn.h"],
+    includes = ["src"],
+    visibility = ["//visibility:public"],
+)
+""",
+    strip_prefix = "dlfcn-win32-1.4.1",
+    url = "https://github.com/dlfcn-win32/dlfcn-win32/archive/refs/tags/v1.4.1.tar.gz",
+    sha256 = "30a9f72bdf674857899eb7e553df1f0d362c5da2a576ae51f886e1171fbdb399",
+)
+
 load("//bazel:api_binding.bzl", "envoy_api_binding")

 envoy_api_binding()
--- source/extensions/dynamic_modules/BUILD
+++ source/extensions/dynamic_modules/BUILD
@@ -18,7 +18,10 @@ envoy_cc_library(
     deps = [
         ":abi_version_lib",
         "//envoy/common:exception_lib",
-    ],
+    ] + select({
+        "//bazel:windows_x86_64": ["@dlfcn-win32//:dlfcn-win32"],
+        "//conditions:default": [],
+    }),
 )

 envoy_cc_library(
--- source/extensions/dynamic_modules/dynamic_modules.cc
+++ source/extensions/dynamic_modules/dynamic_modules.cc
@@ -1,6 +1,16 @@
 #include "source/extensions/dynamic_modules/dynamic_modules.h"

+#ifdef WIN32
+#include "dlfcn.h"
+#ifndef RTLD_NOLOAD
+#define RTLD_NOLOAD 0
+#endif
+#ifndef RTLD_NODELETE
+#define RTLD_NODELETE 0
+#endif
+#else
 #include <dlfcn.h>
+#endif

 #include <string>

@@ -82,7 +92,11 @@ absl::StatusOr<DynamicModulePtr> newDynamicModuleByName(const absl::string_view
                                                    " is not set"));
   }
   const std::filesystem::path file_path_absolute =
+#ifdef WIN32
+      std::filesystem::absolute(fmt::format("{}/lib{}.dll", module_search_path, module_name));
+#else
       std::filesystem::absolute(fmt::format("{}/lib{}.so", module_search_path, module_name));
+#endif
   return newDynamicModule(file_path_absolute, do_not_close, load_globally);
 }

